@using System.Text.Json

@{
    var memberID = Context.Session.GetString("MemberID");
    var token = Context.Session.GetString("Token");

    var googleMemberId = Context.Session.GetString("GoogleMemberID");
    var googleMemberFirstName = Context.Session.GetString("GoogleMemberFirstName");
    
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - FUNNOW</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @*     <link rel="stylesheet" href="~/testModel.styles.css" asp-append-version="true" />
    *@
    <!-- 套版的CSS -->
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="~/image/ming_img/funnowlogo3.png" type="image/png">
    <title>FUNNOW</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/css/ming_css/bootstrap.css">
    <link rel="stylesheet" href="~/ming/vendors/linericon/style.css">
    <link rel="stylesheet" href="~/css/ming_css/font-awesome.min.css">
    <link rel="stylesheet" href="~/ming/vendors/owl-carousel/owl.carousel.min.css">
    <link rel="stylesheet" href="~/ming/vendors/bootstrap-datepicker/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="~/ming/vendors/nice-select/css/nice-select.css">
    <link rel="stylesheet" href="~/ming/vendors/owl-carousel/owl.carousel.min.css">

    <!-- main css -->
    <link rel="stylesheet" href="~/css/ming_css/style.css">
    <link rel="stylesheet" href="~/css/ming_css/styleparty.css">
    <link rel="stylesheet" href="~/css/ming_css/responsive.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.3/air-datepicker.min.css">


    <style>
        .booking-area {
            background-color: #20274d;
            padding: 20px;
        }

        .form-control, .btn {
            margin-bottom: 10px;
        }

        .d-flex.align-items-center label {
            color: white;
            margin-bottom: 0;
            margin-right: 3px; /* 減少標籤與輸入框之間的間距 */
            white-space: nowrap; /* 確保標籤不換行 */
        }

        .d-flex.align-items-center input {
            flex-grow: 1; /* 確保輸入框佔據剩餘空間 */
        }
    </style>


    @await RenderSectionAsync("Styles", required: false)


</head>
<body>
    <!--================標題列 Header Area =================-->
    <header class="header_area">
        <!-- 導航欄 -->
        <div class="container-fluid" style="padding: 0;">
            <nav class="navbar navbar-expand-lg navbar-light" style="height: 60px;">
                <!-- Brand and toggle get grouped for better mobile display -->
                <a class="navbar-brand logo_h" href="/home/index" style="padding:5px;">
                    <img src="~/image/ming_img/newnewLogo.png" style="height: 40px; border-radius: 12px; margin-bottom:5px" />
                </a>

                <div id="guestContent" style="display: none; margin-top:10px">
                    <label>歡迎路過客～哎呀~我發現你還沒登入！！！ 趕緊 <a class="btn btn-danger"  href="/Member/Login">登入</a>來探索更多精彩內容!!!</label>
                </div>
                <div id="memberContent" style="display: none;">
                    <label>歡迎我們尊貴的會員ID是<span id="memberId"></span>號的<span id="memberFirstName"></span>完成登入</label>
                    <button id="logoutButton" class="btn btn-primary">登出</button>
                </div>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="navbar-collapse offset collapse" id="navbarSupportedContent">
                    <ul class="nav navbar-nav menu_nav ml-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="/HostManage/Home" target="_blank" style="color:red;">刊登家中空房</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">
                                <img src="~/image/ming_img/flag.jpg" style="height:50px" />
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="accomodation.html">NT $</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Cart/cartItems">
                                <i class="fa-solid fa-cart-shopping"></i>
                            </a>
                        </li>
                        <li class="nav-item submenu dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                <i class="fa-solid fa-user"></i>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="nav-item">
                                    <a class="nav-link" asp-controller="OrderManagement" asp-action="Index">會員訂單</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/OrderManagement/HotelMessenge">住宿訊息</a>
                                </li>                         
                                <li class="nav-item">
                                    <a class="nav-link" asp-controller="HotelsFavorites" asp-action="HotelsFavoritesList">我的最愛</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" asp-controller="Comment" asp-action="Angular_membercomment">評論</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" asp-controller="MemberInformationn" asp-action="Memberinformationn">會員個人資料管理</a>
                                </li>
                            </ul>
                        </li>
                        <li></li>
                        <li></li>
                    </ul>
                </div>
            </nav>
        </div>
        <!-- Date picker and booking button 浮動訂房欄 -->
        <div class="container-fluid booking-area" style="background-color: #20274d; padding: 20px;">
            <div class="row justify-content-center text-center">
                <div class="col-md-2">
                    <input class="form-control mb-2 mr-sm-2" type="text" placeholder="今天想去哪裡旅行" aria-label="Name" id="search-input2">
                </div>
                <div class="col-md-2">
                    <input class="form-control mb-2 mr-sm-2" type="date" placeholder="訂房日期" aria-label="Check-in Date" id="myDatepickerstart2">
                </div>
                <div class="col-md-2">
                    <input class="form-control mb-2 mr-sm-2" type="date" placeholder="退房日期" aria-label="Check-out Date" id="myDatepickerend2">
                </div>
                <div class="col-md-2 d-flex align-items-center">
                    <label for="adults2" style="background-color: transparent; border: none; font-size:20px">多少人一起FunNow:</label>
                    <input class="form-control mb-2 mr-sm-2" type="number" id="adults2" name="adults2" min="1" max="100" value="1">
                </div>
                <div class="col-md-1 d-flex align-items-center">
                    <label for="rooms2" style="background-color: transparent; border: none;font-size:20px">客房數:</label>
                    <input class="form-control mb-2 mr-sm-2" type="number" id="rooms2" name="rooms2" min="1" max="100" value="1">
                </div>
                <div class="col-md-1">
                    <a class="btn btn-outline-success my-2 my-sm-0" href="home/index2" type="submit" id="buttonSubmit2">Book Now</a>
                </div>
            </div>
        </div>
    </header>
    <div>
        @RenderBody()
    </div>

    <footer class="footer-area section_gap">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6 class="footer_title">About Agency</h6>
                        <p>The world has become so fast paced that people don’t want to stand by reading a page of information, they would much rather look at a presentation and understand the message. It has come to a point </p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6 class="footer_title">Navigation Links</h6>
                        <div class="row">
                            <div class="col-4">
                                <ul class="list_style">
                                    <li>
                                        <a href="#">Home</a>
                                    </li>
                                    <li>
                                        <a href="#">Feature</a>
                                    </li>
                                    <li>
                                        <a href="#">Services</a>
                                    </li>
                                    <li>
                                        <a href="#">Portfolio</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-4">
                                <ul class="list_style">
                                    <li>
                                        <a href="#">Team</a>
                                    </li>
                                    <li>
                                        <a href="#">Pricing</a>
                                    </li>
                                    <li>
                                        <a href="#">Blog</a>
                                    </li>
                                    <li>
                                        <a href="#">Contact</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6 class="footer_title">Newsletter</h6>
                        <p>For business professionals caught between high OEM price and mediocre print and graphic output, </p>
                        <div id="mc_embed_signup">
                            <form target="_blank" action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01" method="get" class="subscribe_form relative">
                                <div class="input-group d-flex flex-row">
                                    <input name="EMAIL" placeholder="Email Address" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Email Address '" required="" type="email">
                                    <button class="btn sub-btn"><span class="lnr lnr-location"></span></button>
                                </div>
                                <div class="mt-10 info"></div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-widget instafeed">
                        <h6 class="footer_title">InstaFeed</h6>
                        <ul class="list_style instafeed d-flex flex-wrap">
                            <li>
                                <img src="~/image/ming_img/instagram/Image-01.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-02.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-03.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-04.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-05.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-06.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-07.jpg" alt="">
                            </li>
                            <li>
                                <img src="~/image/ming_img/instagram/Image-08.jpg" alt="">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="border_line"></div>
            <div class="row footer-bottom d-flex justify-content-between align-items-center">
                <p class="col-lg-8 col-sm-12 footer-text m-0">
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    Copyright &copy;
                    <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with
                    <i class="fa fa-heart-o" aria-hidden="true"></i> by
                    <a href="https://colorlib.com" target="_blank">Colorlib</a>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </p>
                <div class="col-lg-4 col-sm-12 footer-social">
                    <a href="#"><i class="fa fa-facebook"></i></a>
                    <a href="#"><i class="fa fa-twitter"></i></a>
                    <a href="#"><i class="fa fa-dribbble"></i></a>
                    <a href="#"><i class="fa fa-behance"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <!-- 引入jQuery庫 -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/ming_js/site.js" asp-append-version="true"></script>
    <script src="https://kit.fontawesome.com/4f1ac4ae93.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="~/js/ming_js/jquery-3.2.1.min.js"></script>
    <script src="~/js/ming_js/popper.js"></script>
    <script src="~/js/ming_js/bootstrap.min.js"></script>
    <script src="~/ming/vendors/owl-carousel/owl.carousel.min.js"></script>
    <script src="~/js/ming_js/jquery.ajaxchimp.min.js"></script>
    <script src="~/js/ming_js/mail-script.js"></script>
    <script src="~/ming/vendors/bootstrap-datepicker/bootstrap-datetimepicker.min.js"></script>
    <script src="~/ming/vendors/nice-select/js/jquery.nice-select.js"></script>
    <script src="~/js/ming_js/mail-script.js"></script>
    <script src="~/js/ming_js/stellar.js"></script>
    <script src="~/ming/vendors/lightbox/simpleLightbox.min.js"></script>
    <script src="~/js/ming_js/custom.js"></script>

  

    <script>
        //決定nav bar的會員資訊是否顯示
        document.addEventListener("DOMContentLoaded", function () {
           
            var googleMemberId = '@googleMemberId';
            var googleMemberFirstName = '@googleMemberFirstName';
            var memberID = '@memberID';
            var memberFirstNameElement = document.getElementById("memberFirstName");
            var memberContentElement = document.getElementById("memberContent");
            var guestContentElement = document.getElementById("guestContent");
            var memberIdElement = document.getElementById("memberId");

            
            // 如果都沒有值，顯示訪客內容
            if (!googleMemberId && !googleMemberFirstName && !memberID) 
            {
                if (guestContentElement) guestContentElement.style.display = "block";
                console.log("這是Layout訪客");
            }
            // 判斷若有googlememberID，顯示googlememberID內容
            else if (googleMemberId && googleMemberFirstName) 
            {
                if (memberContentElement) memberContentElement.style.display = "block";
                if (memberIdElement) memberIdElement.innerText = googleMemberId;
                if (memberFirstNameElement) memberFirstNameElement.innerText = googleMemberFirstName;
 
                console.log("這是Layout:Google登入" + googleMemberId + googleMemberFirstName);
            }
            // 若以上都沒有才顯示member內容
            else if (memberID) 
            {
                fetchMemberData(memberID);
            }
       
            //點下登出按鈕，把session的資料清空，也把google登入的session清空
            document.getElementById("logoutButton").addEventListener("click", function () 
            {
                if (guestContentElement) guestContentElement.style.display = "block";
                if (memberContentElement) memberContentElement.style.display = "none";
                // 重定向到登出操作方法
                window.location.href = "@Url.Action("Logout", "Member")";
            });
        });


        async function fetchMemberData(memberID) {
            
            var googleMemberId = '@googleMemberId';
            var googleMemberFirstName = '@googleMemberFirstName';
            var memberID = '@memberID';
            var memberFirstNameElement = document.getElementById("memberFirstName");
            var memberContentElement = document.getElementById("memberContent");
            var guestContentElement = document.getElementById("guestContent");
            var memberIdElement = document.getElementById("memberId");
            
            try {
                const response = await fetch(`https://localhost:7103/api/Members/searchByID?ID=${memberID}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },

                });
                if (response.ok) 
                {
                    const data = await response.json(); // 將回應內容解析為 JSON
                    if (memberContentElement) memberContentElement.style.display = "block";
                    if (memberIdElement) memberIdElement.innerText = memberID;
                    if (memberFirstNameElement) memberFirstNameElement.innerText = data.firstName;
                    console.log("這是Layout:一般登入" + memberID + data.firstName);
                } else {
                    const errorText = await response.text();
                    console.error('查詢失敗:', errorText);
                    alert('查詢失敗，請稍後再試');
                }
            } catch (error) {
                console.error('發生錯誤:', error);
                alert(`發生錯誤，請稍後再試。錯誤信息: ${error.message}`);
            }
        }
    </script>


    // <script>
    //     //如果莫名出錯應該是這一段有錯
    //     document.addEventListener('DOMContentLoaded', function () {
    //         // 監聽滾動事件
    //         window.addEventListener('scroll', function () {
    //             var floatingContainer = document.querySelector('.floating-container');
    //             if (!floatingContainer) {
    //                 console.warn('No floating container found.');
    //                 return; // 如果沒有找到 floating-container 元素，直接返回
    //             }
    //             var scrollPosition = window.scrollY || window.pageYOffset;

    //             // 如果滾動至頁面中間，顯示浮動容器，否則隱藏
    //             if (scrollPosition > (window.innerHeight / 2)) {
    //                 floatingContainer.style.display = 'block';
    //             }
    //             // else {
    //             //     floatingContainer.style.display = 'none';
    //             // }
    //         });
    //     });
    // </script>

    <script>
        $(document).ready(function () {
            // 頁面剛載入時隱藏訂房欄，顯示導航欄
            $('.booking-area').hide();
            $('.navbar').show();

            // 初始檢查滾動距離，以確保在頁面載入時的初始狀態正確
            $(window).trigger('scroll');

            // 當滾動頁面時
            $(window).scroll(function () {
                // 獲取目前的滾動距離
                var scrollDistance = $(window).scrollTop();

                // 如果滾動距離超過 0，則隱藏導航欄和訂房欄
                if (scrollDistance > 0) {
                    $('.navbar').hide();
                    $('.booking-area').hide();
                } else {
                    // 如果滾動距離小於等於 0，則顯示導航欄，隱藏訂房欄
                    $('.navbar').show();
                    $('.booking-area').hide();
                }

                // 如果滾動的距離超過 500px，則顯示訂房欄
                if (scrollDistance > 500)
                    $('.booking-area').show();
                else // 如果滾動距離小於等於 500，則隱藏訂房欄
                    $('.booking-area').hide();


                if (scrollDistance === 0) {  // 回到原點時
                    $('.navbar').show();
                    $('.booking-area').hide();
                }
            });
        });

    </script>

    <script>
        //調整浮動搜尋欄的預設日期
        document.addEventListener('DOMContentLoaded', function () {
            // 獲取今天的日期
            var today = new Date();
            var tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            // 格式化日期為 yyyy-mm-dd
            var todayFormatted = today.toISOString().split('T')[0];
            var tomorrowFormatted = tomorrow.toISOString().split('T')[0];

            // 設定 input 預設值
            document.getElementById('myDatepickerstart2').value = todayFormatted;
            document.getElementById('myDatepickerend2').value = tomorrowFormatted;
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
